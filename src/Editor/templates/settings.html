{% load static %}
<!DOCTYPE html>
<html lang="tr-TR" class="js">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="HTML and PDF Editor for OCE App, Produced by IQVIA">
    <!-- Fav Icon  -->
    <link rel="shortcut icon" href="{% static 'images/iqvialogoicon.png' %}">
    <!-- Page Title  -->
    <title>IQVIA | OCE Editor</title>
    <!-- StyleSheets  -->
    <link rel="stylesheet" href="{% static 'css/dashlite.css' %}">
    <link id="skin-default" rel="stylesheet" href="{% static 'css/theme.css' %}">
    <script src="{% static 'js/jquery-3.6.0.js' %}"></script>
    <script src="{% static 'js/jquery-ui.js' %}"></script>
</head>

<body class="nk-body npc-apps apps-only has-apps-sidebar npc-apps-files">
    {% if user.dark_mode %}
    <script>
        var toggle = document.getElementsByClassName('dark-switch')[0];
        var body = document.getElementsByTagName('body')[0];
        body.classList.add('dark-mode');
        toggle.classList.add('active');
    </script>
    {% endif %}
    <div class="nk-app-root">
        <!-- main @s -->
        <div class="nk-main ">
            <!-- wrap @s -->
            <div class="nk-wrap ">
                <!-- main header @s -->
                <div class="nk-header nk-header-fixed is-light">
                    <div class="container-fluid">
                        <div class="nk-header-wrap">
                            <div class="nk-header-app-name">
                                    <img class="logo-img img-fluid me-3" style="max-width:170px;" src="{% static 'images/iqvialogo.png' %}" srcset="{% static 'images/iqvialogo.png' %}" alt="logo">
                                <div class="nk-header-app-info">
                                    <span class="lead-text ms-4">OCE Editor</span>
                                </div>
                            </div>
                            <div class="nk-header-tools">
                                <ul class="nk-quick-nav">
                                    <li class="dropdown help-dropdown">
                                        <a href="#" class="dropdown-toggle nk-quick-nav-icon" data-bs-toggle="dropdown">
                                            <div class=""><em class="icon icon-circle bg-success-dim ni ni-help"></em></div>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-xl dropdown-menu-end">
                                            <div class="dropdown-head">
                                                <span class="sub-title nk-dropdown-title">SSS</span>
                                            </div>
                                            <div class="dropdown-body">
                                                <div class="nk-help">
                                                    <div class="dropdown-foot">
                                                        <a href="#">Nasıl sekans eklerim?</a>
                                                    </div>
                                                    <div class="dropdown-foot">
                                                        <a href="#">Sunumu OCE'ye nasıl gönderebilirim?</a>
                                                    </div>
                                                    <div class="dropdown-foot">
                                                        <a href="#">bla bla</a>
                                                    </div>
                                                </div><!-- .nk-notification -->
                                            </div><!-- .nk-dropdown-body -->
                                            <div class="dropdown-foot dropdown-notification center">
                                                <a href="#">Hepsini Görüntüle</a>
                                            </div>
                                        </div>
                                    </li><!-- .dropdown -->
                                    <li class="dropdown notification-dropdown">
                                        <a href="#" class="dropdown-toggle nk-quick-nav-icon notification-toggle" data-bs-toggle="dropdown">
                                            <div class=""><em class="icon icon-circle ni ni-bell"></em></div>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-xl dropdown-menu-end">
                                            <div class="dropdown-head">
                                                <span class="sub-title nk-dropdown-title">BİLDİRİMLER</span>
                                            </div>
                                            <div class="dropdown-body">
                                                <div class="nk-notification">
                                                    <div id="notification-panel">
                                                        <!-- Notifications will be dynamically added here -->
                                                    </div>
                                                </div>
                                            </div><!-- .nk-dropdown-body -->
                                        </div>
                                    </li><!-- .dropdown -->                                 
                                    <li class="dropdown user-dropdown">
                                        <a href="#" class="dropdown-toggle me-n1" data-bs-toggle="dropdown">
                                            <div class="user-toggle">
                                                <div class="user-avatar sm">
                                                    <img class="logo-img img-fluid" style="max-width:170px;" src="{% if user.company.logo %}{{ user.company.logo.url }}{% else %}{% static 'images/company_logo.png' %}{% endif %}" alt="logo">
                                                </div>
                                            </div>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-md dropdown-menu-end">
                                            <div class="dropdown-inner user-card-wrap bg-lighter d-none d-md-block">
                                                <div class="user-card">
                                                    <div class="user-avatar">
                                                        <span>{{ user.first_name.0 }}{{ user.last_name.0 }}</span>
                                                    </div>
                                                    <div class="user-info">
                                                        <span class="lead-text">{{ user.company.name }}</span>
                                                        <span class="sub-text">{{ user.first_name }} {{ user.last_name }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown-inner">
                                                <ul class="link-list">
                                                    <li><a href="{% url 'settings' %}"><em class="icon ni ni-setting-alt"></em><span>Ayarlar</span></a></li>
                                                    <li><a id="darkModeLink" class="dark-switch"><em class="icon ni ni-moon"></em><span>Koyu Tema</span></a></li>
                                                </ul>
                                            </div>
                                            <div class="dropdown-inner">
                                                <ul class="link-list">
                                                    <li><a href="{% url 'logout' %}"><em class="icon ni ni-signout"></em><span>Çıkış Yap</span></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- main header @e -->
                <!-- content @s -->
                <div class="nk-content p-0">
                    <div class="nk-content-inner">
                        <div class="nk-content-body">
                            <div class="nk-fmg">
                                <div class="nk-fmg-aside" data-content="files-aside" data-toggle-overlay="true" data-toggle-body="true" data-toggle-screen="lg" data-simplebar>
                                    <div class="nk-fmg-aside-wrap">
                                        <div class="nk-fmg-aside-top">
                                            <ul class="nk-fmg-menu">
                                                <li>
                                                    <a class="nk-fmg-menu-item" href="{% url 'folders' %}">
                                                        <em class="icon ni ni-file-docs"></em>
                                                        <span class="nk-fmg-menu-text">Klasörler</span>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="nk-fmg-menu-item" href="{% url 'presentation_list' %}">
                                                        <em class="icon ni ni-img"></em>
                                                        <span class="nk-fmg-menu-text">Sunumlar</span>
                                                    </a>
                                                </li>                        

                                                <li class="active">
                                                    <a class="nk-fmg-menu-item" href="{% url 'settings' %}">
                                                        <em class="icon ni ni-setting-alt"></em>
                                                        <span class="nk-fmg-menu-text">Ayarlar</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div><!-- .nk-fmg-aside -->
                                <div class="card" style="margin-top: -5px;">
                                    <div class="card-aside-wrap">
                                        <div class="card-inner card-inner-lg">
                                            <div class="nk-block-head nk-block-head-lg">
                                                <div class="nk-block-between">
                                                    <div class="nk-block-head-content">
                                                        <h4 class="nk-block-title">Ayarlar</h4>
                                                        <div id="success-alert" class="alert alert-success" style="display: none;"></div>
                                                        
                                                    </div>
                                                    <div class="nk-block-head-content align-self-start d-lg-none">
                                                        <a href="#" class="toggle btn btn-icon btn-trigger mt-n1" data-target="userAside"><em class="icon ni ni-menu-alt-r"></em></a>
                                                    </div>
                                                </div>
                                            </div><!-- .nk-block-head -->
                                            <div class="nk-block">
                                                <div class="nk-data data-list">
                                                    <div class="data-head">
                                                        <h6 class="overline-title">ŞİRKET PROFİLİ</h6>
                                                    </div>
                                                    <div class="data-item" data-bs-toggle="modal">
                                                        <div class="data-col">
                                                            <span class="data-label">Şirket Adı</span>
                                                            <span class="data-value">{{user.company}}</span>
                                                        </div>
                                                        <div class="data-col data-col-end"></div>
                                                    </div><!-- data-item -->
                                                    <div class="data-item">
                                                        <div class="data-col">
                                                            <span class="data-label">Şirket Logosu</span>
                                                            <img class='company-logo' src="{% if user.company.logo %}{{ user.company.logo.url }}{% else %}{% static 'images/company_logo.png' %}{% endif %}" alt="" style="width:50px;height:50px;">
                                                        </div>
                                                        <div class="data-col data-col-end" data-bs-toggle="modal" data-bs-target="#profile-edit"><span class="data-more"><em class="icon ni ni-forward-ios"></em></span></div>
                                                    </div><!-- data-item -->
                                                </div><!-- data-list -->
                                                <div class="nk-data data-list">
                                                    <div class="data-head">
                                                        <h6 class="overline-title">KULLANICI PROFİLİ</h6>
                                                    </div>
                                                    <div class="data-item" >
                                                        <div class="data-col">
                                                            <span class="data-label">Kullanıcı Adı</span>
                                                            <span class="data-value" id='new-user-username'>{{user.username}}</span>
                                                        </div>
                                                        <div class="data-col data-col-end" data-bs-toggle="modal" data-bs-target="#username-edit"><a href="#" class="link link-primary">Kullanıcı Adı Değiştir</a></div>
                                                    </div><!-- data-item -->
                                                    <div class="data-item">
                                                        <div class="data-col">
                                                            <span class="data-label">Şifre</span>
                                                            <span class="data-value">********</span>
                                                        </div>
                                                        <div class="data-col data-col-end" data-bs-toggle="modal" data-bs-target="#userpassword-edit"><a href="#" class="link link-primary">Şifre Değiştir</a></div>
                                                    </div><!-- data-item -->

                                                </div><!-- data-list -->
                                                <div class="nk-data data-list">
                                                    <div class="data-head">
                                                        <h6 class="overline-title">SALESFORCE GİRİŞ BİLGİLERİ</h6>
                                                    </div>
                                                    <div class="data-item">
                                                        <div class="data-col">
                                                            <span class="data-label">Salesforce Kullanıcı Adı</span>
                                                            <span class="data-value" id='sf-new-username'>{{user.company.salesforce_username}}</span>
                                                        </div>
                                                        <div class="data-col data-col-end" data-bs-toggle="modal" data-bs-target="#sfusername-edit"><a href="#" class="link link-primary">Kullanıcı Adı Değiştir</a></div>
                                                    </div><!-- data-item -->
                                                    <div class="data-item">
                                                        <div class="data-col">
                                                            <span class="data-label">Salesforce Şifresi</span>
                                                            <span class="data-value">********</span>
                                                        </div>
                                                        <div class="data-col data-col-end" data-bs-toggle="modal" data-bs-target="#sfpassword-edit"><a href="#" class="link link-primary">Şifre Değiştir</a></div>
                                                    </div><!-- data-item -->

                                                </div><!-- data-list -->
                                            </div><!-- .nk-block -->
                                        </div>
                                    </div><!-- .card-aside-wrap -->
                                </div><!-- .card -->
                            </div><!-- .nk-fmg -->
                        </div>
                    </div>
                </div>
                <!-- content @e -->
            </div>
            <!-- wrap @e -->
        </div>
        <!-- main @e -->
    </div>
    <!-- app-root @e -->
    <!-- @@ Profile Edit Modal @start -->
    <div class="modal fade" role="dialog" id="profile-edit">
        <div class="modal-dialog modal-dialog-centered modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header align-center">
                    <div class="nk-file-title">
                        <div class="nk-file-name">
                            <div class="nk-file-name-text"><span class="title">Şirket Logosunu Güncelle</span></div>
                        </div>
                    </div>
                    <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                </div>
                <div class="modal-body modal-body-md">
                    <div class="row gy-4">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label" for="phone-no">Şirket Logosu</label>
                                <br>
                                <img class='ms-3 bg-white company-logo' src="{% if user.company.logo %}{{ user.company.logo.url }}{% else %}{% static 'images/company_logo.png' %}{% endif %}" alt="" style="width:50px;height:50px;background-color:white;">

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mt-5">
                                <input type="file" class="form-control form-control-md">
                            </div>
                        </div>
                        <div class="col-12 d-flex justify-content-end mt-3">
                            <ul class="d-flex gx-4 gy-2 align-center justify-content-end mt-3">
                                <li class='ms-auto'>
                                    <a href="#" data-bs-dismiss="modal" class="link link-light">İptal</a>
                                </li>
                                <li>
                                    <a href="#" class="btn btn-lg btn-primary"  data-bs-dismiss="modal">Güncelle</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div><!-- .modal-body -->
            </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
    </div><!-- .modal @end-->

    <!-- @@ Username Edit Modal @start -->
    <div class="modal fade" role="dialog" id="username-edit">
        <div class="modal-dialog modal-dialog-centered modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header align-center">
                    <div class="nk-file-title">
                        <div class="nk-file-name">
                            <div class="nk-file-name-text"><span class="title">Kullanıcı Adı Güncelle</span></div>
                            
                        </div>
                    </div>
                    <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                </div>
                <div class="modal-body modal-body-md">
                    <div class="row gy-4">
                        <div class="col-12">
                            <div class="form-group">
                                <div class="alert alert-danger error-message1" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label" for="full-name">Kullanıcı Adı</label>
                                <input type="text" class="form-control form-control-md" id="user-username" value="{{user.username}}">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label" for="phone-no">Şifre</label>
                                <input type='password' id="user-password" class="form-control form-control-md">
                            </div>
                        </div>

                        <div class="col-12 d-flex justify-content-end mt-3">
                            <ul class="d-flex gx-4 gy-2 align-center justify-content-end mt-3">
                                <li class='ms-auto'>
                                    <a href="#" data-bs-dismiss="modal" class="link link-light">İptal</a>
                                </li>
                                <li>
                                    <a class="btn btn-lg btn-primary" id="update-username-btn">Güncelle</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div><!-- .modal-body -->
            </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
    </div><!-- .modal @end-->

    <!-- @@ User Password Edit Modal @start -->
    <!-- @@ User Password Edit Modal @start -->
    <div class="modal fade" role="dialog" id="userpassword-edit">
        <div class="modal-dialog modal-dialog-centered modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header align-center">
                    <div class="nk-file-title">
                        <div class="nk-file-name">
                            <div class="nk-file-name-text"><span class="title">Şifre Değiştir</span></div>
                        </div>
                    </div>
                    <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                </div>
                <div class="modal-body modal-body-md">
                    <div class="row gy-4">
                        <div class="col-12">
                            <div class="form-group">
                                <div class="alert alert-danger error-message2" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label" for="old-password">Eski Şifre</label>
                                <input type="password" class="form-control form-control-md" id="old-user-password">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label" for="new-password">Yeni Şifre</label>
                                <input type="password" class="form-control form-control-md" id="new-user-password">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label" for="confirm-password">Yeni Şifre (Tekrar)</label>
                                <input type="password" class="form-control form-control-md" id="confirm-new-user-password">
                            </div>
                        </div>

                        <div class="col-12 d-flex justify-content-end mt-3">
                            <ul class="d-flex gx-4 gy-2 align-center justify-content-end mt-3">
                                <li class='ms-auto'>
                                    <a href="#" data-bs-dismiss="modal" class="link link-light">İptal</a>
                                </li>
                                <li>
                                    <a href="#" class="btn btn-lg btn-primary" id="update-password-btn">Güncelle</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div><!-- .modal-body -->
            </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
    </div><!-- .modal @end--><!-- .modal @end-->



    <!-- @@ SF Username Edit Modal @start -->
    <div class="modal fade" role="dialog" id="sfusername-edit">
        <div class="modal-dialog modal-dialog-centered modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header align-center">
                    <div class="nk-file-title">
                        <div class="nk-file-name">
                            <div class="nk-file-name-text"><span class="title">Salesforce Kullanıcı Adı Değiştir</span></div>
                        </div>
                    </div>
                    <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                </div>
                <div class="modal-body modal-body-md">
                    <div class="row gy-4">
                        <div class="col-12">
                            <div class="form-group">
                                <div class="alert alert-danger error-message3" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label" for="full-name">Salesforce Kullanıcı Adı</label>
                                <input type="text" class="form-control form-control-md" id="sf-user-name" value="{{user.company.salesforce_username}}" placeholder="Enter Company name">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label">Kullanıcı Şifresi</label>
                                <input type='password' id="sf-user-password" class="form-control form-control-md">
                            </div>
                        </div>

                        <div class="col-12 d-flex justify-content-end mt-3">
                            <ul class="d-flex gx-4 gy-2 align-center justify-content-end mt-3">
                                <li class='ms-auto'>
                                    <a href="#" data-bs-dismiss="modal" class="link link-light">İptal</a>
                                </li>
                                <li>
                                    <a href="#" class="btn btn-lg btn-primary" id='update-sf-username-btn'>Güncelle</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div><!-- .modal-body -->
            </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
    </div><!-- .modal @end-->

    <!-- @@ User Password Edit Modal @start -->
    <div class="modal fade" role="dialog" id="sfpassword-edit">
        <div class="modal-dialog modal-dialog-centered modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header align-center">
                    <div class="nk-file-title">
                        <div class="nk-file-name">
                            <div class="nk-file-name-text"><span class="title">Salesforce Şifresi Değiştir</span></div>
                        </div>
                    </div>
                    <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                </div>
                <div class="modal-body modal-body-md">
                    <div class="row gy-4">
                        <div class="col-12">
                            <div class="form-group">
                                <div class="alert alert-danger error-message4" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label">Yeni SF Şifresi</label>
                                <input type="password" id='new-sf-password' class="form-control form-control-md">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label" for="phone-no">Yeni SF Şifresi (Tekrar)</label>
                                <input type="password" id='confirm-new-sf-password' class="form-control form-control-md">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label class="form-label" for="phone-no">Kullanıcı Şifresi</label>
                                <input type="password" id='user-password-for-sf-password' class="form-control form-control-md">
                            </div>
                        </div>
                        

                        <div class="col-12 d-flex justify-content-end mt-3">
                            <ul class="d-flex gx-4 gy-2 align-center justify-content-end mt-3">
                                <li class='ms-auto'>
                                    <a href="#" data-bs-dismiss="modal" class="link link-light">İptal</a>
                                </li>
                                <li>
                                    <a href="#" class="btn btn-lg btn-primary" id="update-sf-password-btn">Güncelle</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div><!-- .modal-body -->
            </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
    </div><!-- .modal @end-->

    <script>
        $('#update-profile-btn').click(function() {
            var inputFile = $('#profile-edit input[type="file"]');
            if (inputFile[0].files.length > 0) {
                var file = inputFile[0].files[0];
                var formData = new FormData();
                formData.append('logo', file);
                
                // Get the CSRF token value from the cookie
                window.CSRF_TOKEN = "{{ csrf_token }}";
                
                $.ajax({
                    url: "{% url 'save_logo' %}",
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    beforeSend: function(xhr, settings) {
                        // Set the CSRF token header for the request
                        xhr.setRequestHeader("X-CSRFToken", window.CSRF_TOKEN);
                    },
                    success: function(response) {
                        console.log('Logo saved successfully');
                        // Update the image source with the new logo URL
                        if (response.logo_url) {
                            $('.company-logo').attr('src', response.logo_url);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.log('Error occurred while saving the logo');
                    }
                });
            } else {
                alert('Please select a photo.');
            }
        });
    </script>
    
    
    <!-- footer @s -->
    <div class="nk-footer">
        <div class="container-fluid">
            <div class="nk-footer-wrap">
                <div class="nk-footer-copyright ms-auto">Tüm Hakları Saklıdır. &copy; 2023  <a href="https://www.iqvia.com/tr-tr/locations/turkey" target="_blank">IQVIA  </a>
                </div>
            </div>
        </div>
    </div>
    <!-- footer @e -->
    <!-- JavaScript -->
    <script>
        $(document).ready(function() {
            $('#update-username-btn').click(function(event) {
                event.preventDefault();
                var newUsername = $('#user-username').val();
                var password = $('#user-password').val();
    
                var data = {
                    username: newUsername,
                    password: password,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                };
    
                $.ajax({
                    url: "{% url 'update_username' %}",
                    type: 'POST',
                    data: data,
                    success: function(response) {
                        if (response.success) {
                            $('#new-user-username').text(newUsername);
                            // Close the modal
                            $('#username-edit').modal('hide');
                            $('#user-password').val('');
                            // Display success alert
                            $('#success-alert').text(response.message);
                            $('#success-alert').show();
                            // Hide success alert after 3 seconds
                            setTimeout(function() {
                                $('#success-alert').hide();
                            }, 3000);
    
                            // Additional actions after successful update
                        } else {

                            $('#user-password').val('');
                            // Display error message
                            $('.error-message1').text(response.message);
                            $('.error-message1').show();
    
                            // Keep the modal open
                        }
                    },
                    error: function(xhr, status, error) {
                        // Display error message
                        $('.error-message1').text('An error occurred: ' + error);
                        $('.error-message1').show();
    
                        // Keep the modal open
                    }
                });
            });
        });
    </script>

    <script>
        $(document).ready(function() {
            $('#update-password-btn').click(function(event) {
        
                var oldPassword = $('#old-user-password').val();
                var newPassword = $('#new-user-password').val();
                var confirmPassword = $('#confirm-new-user-password').val();
        
                // Front-end validation
                if (newPassword !== confirmPassword) {
                    var message = "New passwords doesn't match."
                    // Display error message for password mismatch
                    $('.error-message2').text(message);
                    $('.error-message2').show();
                    console.log('hata');
                    return;
                }
        
                var data = {
                    old_password: oldPassword,
                    new_password: newPassword,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                };
        
                $.ajax({
                    url: "{% url 'change_password' %}",
                    type: 'POST',
                    data: data,
                    success: function(response) {
                        
        
                        if (response.success) {
                            // Clear the input fields
                            $('#old-user-password').val('');
                            $('#new-user-password').val('');
                            $('#confirm-new-user-password').val('');
                            // Close the modal
                            $('#userpassword-edit').modal('hide');
        
                            // Display success alert
                            $('#success-alert').text(response.message);
                            $('#success-alert').show();
        
                            // Hide success alert after 3 seconds
                            setTimeout(function() {
                                $('#success-alert').hide();
                            }, 3000);
        
                            // Additional actions after successful update
                        } else {
                            // Display error message
                            $('.error-message2').text(response.message);
                            $('.error-message2').show();
        
                            // Keep the modal open
                        }
                    },
                    error: function(xhr, status, error) {
                        // Display error message
                        $('.error-message2').text('An error occurred: ' + error);
                        $('.error-message2').show();
        
                        // Keep the modal open
                    }
                });
            });
        });
    </script>

    <script>
        $(document).ready(function() {
            $('#update-sf-username-btn').click(function(event) {
        
                var newUsername = $('#sf-user-name').val();
                var password = $('#sf-user-password').val();
        
                // Perform front-end validation if needed
        
                var data = {
                    username: newUsername,
                    password: password,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                };
        
                $.ajax({
                    url: "{% url 'update_sf_username' %}",
                    type: 'POST',
                    data: data,
                    success: function(response) {


                        if (response.success) {
                            // Clear the input fields
                            $('#sf-user-password').val('');
                            // Close the modal
                            $('#sfusername-edit').modal('hide');
                            $('#sf-new-username').text(newUsername);
                            // Display success alert
                            $('#success-alert').text(response.message);
                            $('#success-alert').show();
        
                            // Hide success alert after 3 seconds
                            setTimeout(function() {
                                $('#success-alert').hide();
                            }, 3000);
        
                            // Additional actions after successful update
                        } else {
                            // Display error message
                            $('.error-message3').text(response.message);
                            $('.error-message3').show();
        
                            // Keep the modal open
                        }
                    },
                    error: function(xhr, status, error) {
                        // Clear the input fields
                        $('#sf-user-password').val('');
                        // Display error message
                        $('#error-message3').text('An error occurred: ' + error);
                        $('#error-message3').show();
        
                        // Keep the modal open
                    }
                });
            });
        });
    </script>

    <script>
        $(document).ready(function() {
            $('#update-sf-password-btn').click(function(event) {
                var newPassword = $('#new-sf-password').val();
                var confirmPassword = $('#confirm-new-sf-password').val();
                var userPassword = $('#user-password-for-sf-password').val();
    
                // Front-end validation
                if (newPassword !== confirmPassword) {
                    // Display error message for password mismatch
                    $('.error-message4').text("New Salesforce passwords don't match.");
                    $('.error-message4').show();
                    return;
                }
    
                var data = {
                    new_password: newPassword,
                    user_password: userPassword,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                };
    
                $.ajax({
                    url: "{% url 'change_sf_password' %}",
                    type: 'POST',
                    data: data,
                    success: function(response) {
                        if (response.success) {
                            $('#sfpassword-edit').modal('hide');
                            // Clear the input fields
                            $('#new-sf-password').val('');
                            $('#confirm-new-sf-password').val('');
                            $('#user-password-for-sf-password').val('');
    
                            // Display success message
                            $('.error-message4').hide();
                            $('#success-alert').text(response.message);
                            $('#success-alert').show();
    
                            // Hide success alert after 3 seconds
                            setTimeout(function() {
                                $('#success-alert').hide();
                            }, 3000);
    
                            // Additional actions after successful update
                        } else {
                            $('#new-sf-password').val('');
                            $('#confirm-new-sf-password').val('');
                            $('#user-password-for-sf-password').val('');
                            // Display error message
                            $('.error-message4').text(response.message);
                            $('.error-message4').show();
                        }
                    },
                    error: function(xhr, status, error) {
                        // Display error message
                        $('.error-message4').text('An error occurred: ' + error);
                        $('.error-message4').show();
                    }
                });
            });
        });
    </script>

    <script src="{% static 'js/bundle.js' %}"></script>
    <script src="{% static 'js/scripts.js' %}"></script>
    <script>
        $(document).ready(function() {
            var darkModeSwitch = $("#darkModeLink");
            window.CSRF_TOKEN = "{{ csrf_token }}";
        
            darkModeSwitch.click(function(event) {
              event.preventDefault(); // Prevent the default link behavior
        
              var darkModeEnabled = darkModeSwitch.hasClass("active"); // Check if the switch is currently enabled
        
              // Make an AJAX request to the server to update the user's dark_mode field
              $.ajax({
                url: "{% url 'update_dark_mode' %}",
                type: "POST",
                dataType: "json",
                data: {
                  dark_mode: !darkModeEnabled, // Toggle the value of dark_mode
                  'csrfmiddlewaretoken': window.CSRF_TOKEN
                },
                success: function(response) {
                  console.log("Dark mode updated");
                },
                error: function(xhr, status, error) {
                  console.error("Error updating dark mode");
                }
              });
            });
          });
    </script>
    <script>
        $(document).ready(function() {
          // AJAX request to get notifications
          $.ajax({
            url: "{% url 'get_notifications' %}",
            dataType: 'json',
            success: function(data) {
              // Process the received notifications
              var notifications = data.notifications;
              var hasUnread = false; // Flag to check if there are unread notifications
      
              if (notifications.length > 0) {
                // Update the notification panel with the received notifications
                for (var i = 0; i < notifications.length; i++) {
                  var notification = notifications[i];
                  var message = notification.message;
                  var createdAt = notification.created_at;
                  var isRead = notification.is_read; // Retrieve the "is_read" field from the notification
      
                  // Create the notification item
                  var notificationItem = $('<div class="dropdown-foot dropdown-notification"><a href="#">' + message + '</a><em class="icon ni ni-clock ms-2" data-toggle="tooltip" data-placement="top" title="' + createdAt + '"></em></div>');
      
                  // Append the notification item to the panel
                  $('.nk-notification').append(notificationItem);
      
                  // Check if the notification is unread
                  if (!isRead) {
                    hasUnread = true; // Set the flag to true if there is at least one unread notification
                  }
                }
      
                // Reinitialize tooltips
                $('[data-toggle="tooltip"]').tooltip();
              } else {
                // Show a message indicating no notifications
                $('.nk-notification').append('<div class="dropdown-foot dropdown-notification"><p href="#">Bildirim bulunmamaktatır.</p></div>');
              }
      
              // Add or remove the red dot based on the flag
              if (hasUnread) {
                $('.notification-dropdown').append('<span class="unread-indicator"></span>');
              } else {
                $('.unread-indicator').remove();
              }
            },
            error: function() {
              // Handle error if the AJAX request fails
              console.error('Failed to retrieve notifications.');
            }
          });
        });
    </script>
    <script>
        // Click event for opening the dropdown
        $('.notification-toggle').click(function() {
            // Remove the unread indicator
            $('.unread-indicator').remove();
        
            // AJAX request to mark notifications as read
            $.ajax({
                url: "{% url 'mark_notifications_as_read' %}",
                method: 'POST',
                success: function() {
                console.log('Notifications marked as read.');
                },
                error: function() {
                console.error('Failed to mark notifications as read.');
                }
            });
            });
    </script>
    
</body>
</html>